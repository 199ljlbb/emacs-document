<!DOCTYPE html>
<html lang="en">
<head>
  <title>How-to-build-your-own-spacemacs - EMACS-DOCUMENT</title>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
  <meta name="author" content="lujun9972" />
  <style>
   #ds-thread #ds-reset .ds-comment-body p {color: #ffffff;}
   #ds-thread #ds-reset .ds-comment-body p a {color: #ff0;}
   #ds-thread #ds-reset .ds-comment-body p a:hover {color: #0ff;}
   #disqus_thread a {color: #00ffff;}
  </style>
  <link rel="stylesheet" href="http://lujun9972.github.io/emacs-document/media/css/main.css" type="text/css"/>
  <link rel="stylesheet" href="http://lujun9972.github.io/emacs-document/media/css/comment.css" type="text/css"/>
</head>

  <body><div class="container">
<div>
  <header class="masthead">
    <h1 class="masthead-title"><a href="http://lujun9972.github.io/emacs-document/">EMACS-DOCUMENT</a></h1>
    <p>=============&gt;集思广益</p>
    <nav class="site-nav">
      <div class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z" fill="#ffff00"/>
          <path d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z" fill="#ffff00"/>
          <path d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z" fill="#ffff00"/>
        </svg>
      </div>
      <ul class="trigger">
        <li><a href="http://lujun9972.github.io/emacs-document/years/">Years</a></li>
        <li><a href="http://lujun9972.github.io/emacs-document/authors/">Authors</a></li>
        <li><a href="http://lujun9972.github.io/emacs-document/tags/">Tags</a></li>
        <li><a href="http://lujun9972.github.io/emacs-document/about/">About</a></li>
        <li><a href="https://github.com/lujun9972/emacs-document">Github</a></li>
        <li><a href="http://lujun9972.github.io/emacs-document/rss.xml">RSS</a></li>
      </ul>
    </nav>
    <form method="get" id="searchform" action="http://www.google.com/search">
      <input type="text" class="field" name="q" id="s" placeholder="Search">
      <input type="hidden" name="as_sitesearch" value="lujun9972.github.io/emacs-document">
    </form>
  </header>
</div>

<div>
<div class="post">
<h1 class="title">How-to-build-your-own-spacemacs</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgheadline1">1. Getting Emacs ready for the job</a></li>
<li><a href="#orgheadline2">2. Introduce structure in your config : use-package to the rescue</a></li>
<li><a href="#orgheadline3">3. Move in Emacs : the abo-abo way</a></li>
<li><a href="#orgheadline4">4. Bind in Emacs : the general way</a></li>
<li><a href="#orgheadline5">5. Meeting our goal: build yourself a great Spacemacs-like experience</a></li>
<li><a href="#orgheadline6">6. A recipe for a modern Emacs experience</a></li>
</ul>
</div>
</div>
<p>
Build yourself a great Emacs the way you want it, using modern tools.
</p>

<p>
Published Fri, Sep 2, 2016 by <a href="https://google.com/+XXX">Samuel Barreto</a>
</p>

<p>
Emacs is a great environment to build a text editor. Being a really old piece
of software, searching the internet does not always lead to the best or more
recent results. My goal is to help you build an editor inside Emacs using the
best tools for the job, with modern tools and well-crafted packages.
</p>

<p>
In <a href="http://sam217pa.github.io/2016/08/30/how-to-make-your-own-spacemacs/">a previous post</a>, I described the tools I needed to build myself a great
spacemacs-like^<a href="https://sam217pa.github.io/2016/09/02/how-to-build-your-own-spacemacs/#fn:1">1</a> experience inside emacs. In this post, I want to explain the
process of building it in more details. I hope it serves you in building a
cool editor the way you like it.
</p>

<p>
[[<img src="http://blog.oxforddictionaries.com/wp-content/uploads/pottery-wheel.jpg" alt="pottery-wheel.jpg" />
</p>


<blockquote>
<p>
Emacs proficient reader should skip this part and jump directly to the
use-package part <a href="https://sam217pa.github.io/2016/09/02/how-to-build-your-own-spacemacs/#use-package">here</a>. Those that already know about use-package should
jump <a href="https://sam217pa.github.io/2016/09/02/how-to-build-your-own-spacemacs/#move-in-emacs">here</a>, where I talk about ivy, swiper, counsel and general. Those that
do not want to read all my strange french-english prose can and should
jump directly to <a href="https://sam217pa.github.io/2016/09/02/how-to-build-your-own-spacemacs/#recipe">here</a>. I have put up a recipe to a modern Emacs
experience.
</p>
</blockquote>

<p>
Emacs is a text editor and a programming environment built on top of a
programming language, just like Python or Java, called emacs-lisp. The text
editing abilities of a bare Emacs distribution are decent, but today most
Emacs users extend it through other pieces of software called modules or
packages. They are also written in emacs-lisp, often by user of Emacs that
became frustrated by a lack of feature or thought they could do better. The
result is a big ecosystem of emacs-lisp packages, of which you can get an idea
at <a href="https://melpa.org">melpa.org</a>. Anybody can download it and use it to extend the
functionnalities of emacs.
</p>

<p>
One of the main strength of Emacs is its extensibility and flexibility. As our
first step, we are going to learn how to configure it using basic emacs
function.
</p>

<div id="outline-container-orgheadline1" class="outline-2">
<h2 id="orgheadline1"><span class="section-number-2">1</span> Getting Emacs ready for the job</h2>
<div class="outline-text-2" id="text-1">
<p>
<a href="https://images.unsplash.com/photo-1461896836934-ffe607ba8211">https://images.unsplash.com/photo-1461896836934-ffe607ba8211</a>
</p>

<p>
Once you have installed the most recent version of Emacs using your beloved
package manage and opened it, Emacs will create a directory in your $HOME
directory called ~/.emacs.d. When Emacs start, it reads a file in this
directory called ~/.emacs.d/init.el, and execute any emacs-lisp command it
finds in it. We are going to use this file to customize emacs to our liking.
</p>

<blockquote>
<p>
As a version control adept, I have symlinked init.el to a dotfile
repository under VC.
</p>
</blockquote>

<p>
When inside Emacs, press C-x C-f (meaning control-f then control-f), the emacs
command to open a file. Emacs will prompt you for a file to open, and type ~
/.emacs.d/init.el. Emacs being really old, some of its default configuration
are somewhat — er — mysterious and mystical. We are going to use init.el to
introduce some sane defaults. Paste the following chunks using C-y.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">setq</span> delete-old-versions <span style="color: #a45bad;">-1</span> <span style="color: #4f97d7;">)</span>    <span style="color: #2aa1ae; background-color: #292e34;">; </span><span style="color: #2aa1ae; background-color: #292e34;">delete excess backup versions silently</span>
<span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">setq</span> version-control t <span style="color: #4f97d7;">)</span>   <span style="color: #2aa1ae; background-color: #292e34;">; </span><span style="color: #2aa1ae; background-color: #292e34;">use version control</span>
<span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">setq</span> vc-make-backup-files t <span style="color: #4f97d7;">)</span>    <span style="color: #2aa1ae; background-color: #292e34;">; </span><span style="color: #2aa1ae; background-color: #292e34;">make backups file even when in version controlled dir</span>
<span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">setq</span> backup-directory-alist `<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">(</span><span style="color: #2d9574;">"."</span> . <span style="color: #2d9574;">"~/.emacs.d/backups"</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span> <span style="color: #4f97d7;">)</span> <span style="color: #2aa1ae; background-color: #292e34;">; </span><span style="color: #2aa1ae; background-color: #292e34;">which directory to put backups file</span>
<span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">setq</span> vc-follow-symlinks t <span style="color: #4f97d7;">)</span>               <span style="color: #2aa1ae; background-color: #292e34;">; </span><span style="color: #2aa1ae; background-color: #292e34;">don't ask for confirmation when opening symlinked file</span>
<span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">setq</span> auto-save-file-name-transforms '<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">(</span><span style="color: #2d9574;">".*"</span> <span style="color: #2d9574;">"~/.emacs.d/auto-save-list/"</span> t<span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span> <span style="color: #4f97d7;">)</span> <span style="color: #2aa1ae; background-color: #292e34;">;</span><span style="color: #2aa1ae; background-color: #292e34;">transform backups file name</span>
<span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">setq</span> inhibit-startup-screen t <span style="color: #4f97d7;">)</span>  <span style="color: #2aa1ae; background-color: #292e34;">; </span><span style="color: #2aa1ae; background-color: #292e34;">inhibit useless and old-school startup screen</span>
<span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">setq</span> ring-bell-function 'ignore <span style="color: #4f97d7;">)</span>  <span style="color: #2aa1ae; background-color: #292e34;">; </span><span style="color: #2aa1ae; background-color: #292e34;">silent bell when you make a mistake</span>
<span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">setq</span> coding-system-for-read 'utf-8 <span style="color: #4f97d7;">)</span> <span style="color: #2aa1ae; background-color: #292e34;">; </span><span style="color: #2aa1ae; background-color: #292e34;">use utf-8 by default</span>
<span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">setq</span> coding-system-for-write 'utf-8 <span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">setq</span> sentence-end-double-space nil<span style="color: #4f97d7;">)</span>  <span style="color: #2aa1ae; background-color: #292e34;">; </span><span style="color: #2aa1ae; background-color: #292e34;">sentence SHOULD end with only a point.</span>
<span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">setq</span> default-fill-column <span style="color: #a45bad;">80</span><span style="color: #4f97d7;">)</span>   <span style="color: #2aa1ae; background-color: #292e34;">; </span><span style="color: #2aa1ae; background-color: #292e34;">toggle wrapping text at the 80th character</span>
<span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">setq</span> initial-scratch-message <span style="color: #2d9574;">"Welcome in Emacs"</span><span style="color: #4f97d7;">)</span> <span style="color: #2aa1ae; background-color: #292e34;">; </span><span style="color: #2aa1ae; background-color: #292e34;">print a default message in the empty scratch buffer opened at startup</span>
</pre>
</div>

<p>
Place your cursor after the closing paren of the first line and press C-x C-e.
It will execute the previous bits of code. setq is an emacs-lisp word meaning
“set the following variable to the following value”. For the first line, we
could translate in plain english to “set the variable delete-old-versions to
-1”.
</p>

<p>
Now save the init.el modifications by pressing C-x C-s, and quit Emacs by
pressing C-x C-c. Restart it. Now press M-x (depending on your OS, it should
corresponds to Alt-x) and describe-variable, then delete-old-versions. It
should open a buffer with the documentation of the variable, with a line
saying “Its value is -1”. So basically when Emacs started up, it evaluated the
lines of code in ~/.emacs.d/init.el. Now press M-x describe-key and press C-e.
It should print a buffer describing the function attached to the keybindings
C-e
</p>

<p>
In those simple exercises, we covered very important Emacs notion :
</p>

<ol class="org-ol">
<li>Every command is bound to a function. Those function are, most of the
time, defined in emacs-lisp. Some very important function are defined in C
for performance.</li>
<li>You learned that Emacs has a very thorough documentation describing
variables, functions, keybindings…</li>
<li>You learned to modify a variable using emacs-lisp.</li>
<li>You learned how Emacs execute code at startup, and we can leverage that to
customize it to our liking.</li>
</ol>
</div>
</div>

<div id="outline-container-orgheadline2" class="outline-2">
<h2 id="orgheadline2"><span class="section-number-2">2</span> Introduce structure in your config : use-package to the rescue</h2>
<div class="outline-text-2" id="text-2">
<p>
The emacs-lisp package archive with wich you can interact at <a href="https://melpa.org">melpa.org</a> has, at
the time of writing 3 291 packages. The abundance of modules sometimes lead to
something that emacs users call Emacs bankruptcy: a state in which the user
does not understand its own Emacs configuration.
</p>

<blockquote>
<p>
I give up. During the past 6 years of my emacs career, my emacs
configuration file grew to embarrassing levels. As of this morning, it is
well over 1000 lines and is a looming burden of disorganization. Startup
time is poor, customizations exist for languages that I don’t use anymore
(ahem, &gt; csharp-mode), and it has been this way for too long… ——
RyanMcGeary, 2007
</p>
</blockquote>

<p>
To prevent this, John Wiegley, the current emacs maintainer put up a great
package called use-package. So, as our second step, we are going to set up
use-package and use it for the first time. This “meta”-package is a package to
manage other packages and the way they interact. Put the following lines in
your ~/.emacs.d/init.el.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">require</span> '<span style="color: #a45bad;">package</span><span style="color: #4f97d7;">)</span>
</pre>
</div>

<p>
This line basically says to Emacs make available any command present in the 
package module.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">setq</span> package-enable-at-startup nil<span style="color: #4f97d7;">)</span> <span style="color: #2aa1ae; background-color: #292e34;">; </span><span style="color: #2aa1ae; background-color: #292e34;">tells emacs not to load any packages before starting up</span>
<span style="color: #2aa1ae; background-color: #292e34;">;; </span><span style="color: #2aa1ae; background-color: #292e34;">the following lines tell emacs where on the internet to look up</span>
<span style="color: #2aa1ae; background-color: #292e34;">;; </span><span style="color: #2aa1ae; background-color: #292e34;">for new packages.</span>
<span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">setq</span> package-archives '<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">(</span><span style="color: #2d9574;">"org"</span>       . <span style="color: #2d9574;">"http://orgmode.org/elpa/"</span><span style="color: #2aa1ae; background-color: #292e34;">;</span><span style="color: #2aa1ae; background-color: #292e34;">)</span>
                          <span style="color: #67b11d;">(</span><span style="color: #2d9574;">"gnu"</span>       . <span style="color: #2d9574;">"http://elpa.gnu.org/packages/"</span><span style="color: #2aa1ae; background-color: #292e34;">;</span><span style="color: #2aa1ae; background-color: #292e34;">)</span>
                           <span style="color: #b1951d;">(</span><span style="color: #2d9574;">"melpa"</span>     . <span style="color: #2d9574;">"https://melpa.org/packages/"</span><span style="color: #2aa1ae; background-color: #292e34;">;</span><span style="color: #2aa1ae; background-color: #292e34;">)</span>
                            <span style="color: #4f97d7;">(</span><span style="color: #2d9574;">"marmalade"</span> . <span style="color: #2d9574;">"http://marmalade-repo.org/packages/"</span><span style="color: #2aa1ae; background-color: #292e34;">;</span><span style="color: #2aa1ae; background-color: #292e34;">)))</span>
                             <span style="color: #bc6ec5;">(</span>package-initialize<span style="color: #bc6ec5;">)</span> <span style="color: #2aa1ae; background-color: #292e34;">; </span><span style="color: #2aa1ae; background-color: #292e34;">guess what this one does ?</span>

                             <span style="color: #2aa1ae; background-color: #292e34;">;; </span><span style="color: #2aa1ae; background-color: #292e34;">Bootstrap `</span><span style="color: #a45bad; background-color: #292e34;">use-package</span><span style="color: #2aa1ae; background-color: #292e34;">'</span>
                             <span style="color: #bc6ec5;">(</span><span style="color: #4f97d7; font-weight: bold;">unless</span> <span style="color: #2d9574;">(</span>package-installed-p 'use-package<span style="color: #2d9574;">)</span> <span style="color: #2aa1ae; background-color: #292e34;">; </span><span style="color: #2aa1ae; background-color: #292e34;">unless it is already installed</span>
                               <span style="color: #2d9574;">(</span>package-refresh-contents<span style="color: #2d9574;">)</span> <span style="color: #2aa1ae; background-color: #292e34;">; </span><span style="color: #2aa1ae; background-color: #292e34;">updage packages archive</span>
                               <span style="color: #2d9574;">(</span>package-install 'use-package<span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span> <span style="color: #2aa1ae; background-color: #292e34;">; </span><span style="color: #2aa1ae; background-color: #292e34;">and install the most recent version of use-package</span>

                             <span style="color: #bc6ec5;">(</span><span style="color: #4f97d7; font-weight: bold;">require</span> '<span style="color: #a45bad;">use-package</span><span style="color: #bc6ec5;">)</span> <span style="color: #2aa1ae; background-color: #292e34;">; </span><span style="color: #2aa1ae; background-color: #292e34;">guess what this one does too ?</span>
</pre>
</div>

<p>
Now the best way to learn how it works is by reading its documentation. Nah.
Let’s use it first, read then. Restart emacs and put the following line in
your init.el, then go to the end of line (C-e) and press C-x C-e.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">use-package</span> <span style="color: #a45bad;">general</span> <span style="color: #4f97d7;">:ensure</span> t<span style="color: #4f97d7;">)</span>
</pre>
</div>

<p>
It should check for the general package and make sure it is accessible. If
not, the :ensure t part of the previous chunks tells use-package to download
it and place it somewhere accessible, in ~/.emacs.d/elpa/ by default^<a href="https://sam217pa.github.io/2016/09/02/how-to-build-your-own-spacemacs/#fn:2">2</a>.
</p>

<p>
Now every function in the general package is available to you. We will now use
the same use-package statement to customize the general package. We need the
:config keyword of the use-package macro to do just that.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">use-package</span> <span style="color: #a45bad;">general</span> <span style="color: #4f97d7;">:ensure</span> t
             <span style="color: #4f97d7;">:config</span>
             <span style="color: #bc6ec5;">(</span>general-define-key <span style="color: #2d9574;">"C-'"</span> 'avy-goto-word-1<span style="color: #bc6ec5;">)</span>
             <span style="color: #4f97d7;">)</span>
</pre>
</div>

<p>
The third line said “bind to the C-' press the function avy-goto-word-1”. It
means we need the avy package. So let’s use use-package again to download and
load the avy package.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">use-package</span> <span style="color: #a45bad;">avy</span> <span style="color: #4f97d7;">:ensure</span> t<span style="color: #4f97d7;">)</span>
</pre>
</div>

<p>
But then we do not need this package right when we start Emacs. It can wait
until we first call avy-goto-word-1 or any other command from the avy package.
So we are going to put this command in the list of command that triggers the
loading of the avy package. We use the :commands keyword to do that.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">use-package</span> <span style="color: #a45bad;">avy</span> <span style="color: #4f97d7;">:ensure</span> t
             <span style="color: #4f97d7;">:commands</span> <span style="color: #bc6ec5;">(</span>avy-goto-word-1<span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
</pre>
</div>

<p>
So now when we start Emacs, the avy package is not loaded. But when we first
press C-', it will call avy-goto-word-1 and trigger the loading of the avy
package.
</p>

<p>
<a href="https://images.unsplash.com/photo-1453230806017-56d81464b6c5?dpr=1&amp;amp">https://images.unsplash.com/photo-1453230806017-56d81464b6c5?dpr=1&amp;amp</a>
</p>

<p>
Use-package has all kinds of tricks to make sure no code is executed or loaded
before it is needed. You really need to check out use-package on your way to
mold Emacs to your liking.
</p>
</div>
</div>

<div id="outline-container-orgheadline3" class="outline-2">
<h2 id="orgheadline3"><span class="section-number-2">3</span> Move in Emacs : the abo-abo way</h2>
<div class="outline-text-2" id="text-3">
<p>
In Emacs as in all text editor, you move more than you type. You move between
buffers, ie text files loaded into memory. You move between lines. You move
between sentences. You move between semantics unit. You move between files.
You search for files. You search for text. You search for regexp. You search
for projects.
</p>

<p>
It really helps to have a uniform interface to the most common commands you
call.
</p>

<p>
One of the most prolific Emacs-package developper that I know of is called
Oleh Krehel; <a href="https://twitter.com/_abo_abo">abo-abo</a> on Twitter^<a href="https://sam217pa.github.io/2016/09/02/how-to-build-your-own-spacemacs/#fn:3">3</a>. During the past two years, he developped an
ecosystem around a completion framework that he wrote called ivy. This
ecosystem is composed of three packages called ivy, counsel and swiper.
</p>


<div class="figure">
<p><img src="https://static.pexels.com/photos/26662/pexels-photo-26662-large.jpg" alt="pexels-photo-26662-large.jpg" />
</p>
</div>

<p>
Counsel allow you to find recently visited files, to switch between buffers,
to search for a string in the current git directory, to search for a file in
the current git directory, to search for Emacs function, to search for system
applications to open, to search for music in rythmbox, to … . Well, you get
the idea. Swiper allow you to find text really really quickly inside an Emacs
buffer.
</p>

<p>
<a href="https://images.unsplash.com/photo-1466436578965-5cba086a1824">https://images.unsplash.com/photo-1466436578965-5cba086a1824</a>
</p>

<p>
Ivy proposes completion candidates to the two other, and to many other Emacs
function that needs completion and narrowing. You may have heard of another
ecosystem centered around Helm. The spacemacs dev chose to use Helm as a
central tool, but I can assure you that you will not regret chosing the Ivy
way. It is really really fast, really well thought out and really convenient
to use.
</p>

<p>
So now we have a ton on function to bind, and still no way to make that easy.
But do we ?
</p>
</div>
</div>

<div id="outline-container-orgheadline4" class="outline-2">
<h2 id="orgheadline4"><span class="section-number-2">4</span> Bind in Emacs : the general way</h2>
<div class="outline-text-2" id="text-4">
<p>
<a href="https://images.unsplash.com/photo-1463527882365-18201e85a091">https://images.unsplash.com/photo-1463527882365-18201e85a091</a>
</p>

<p>
Recently, a growing user base of Emacs user started to use Evil, a vim
emulation built on top of Emacs command. It works just flawlessly. When they
did, they developped some ways to bind keys to functions like in Vim. One of
the most successful solution to this is evil-leader. And then another Evil
user by the pseudo of noctuid created a package called general.el^<a href="https://sam217pa.github.io/2016/09/02/how-to-build-your-own-spacemacs/#fn:4">4</a>. Of all
the way I know to define keys in Emacs, this one is the most versatile and the
simplest solution to defining keybindings.
</p>

<p>
There is many ways to define keybindings in general.el. Since they are all
constructed around general-define-key, it is the most flexible. So let’s use
that to bind some keys.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #4f97d7;">(</span>general-define-key
 <span style="color: #2aa1ae; background-color: #292e34;">;; </span><span style="color: #2aa1ae; background-color: #292e34;">replace default keybindings</span>
 <span style="color: #2d9574;">"C-s"</span> 'swiper             <span style="color: #2aa1ae; background-color: #292e34;">; </span><span style="color: #2aa1ae; background-color: #292e34;">search for string in current buffer</span>
 <span style="color: #2d9574;">"M-x"</span> 'counsel-M-x        <span style="color: #2aa1ae; background-color: #292e34;">; </span><span style="color: #2aa1ae; background-color: #292e34;">replace default M-x with ivy backend</span>
 <span style="color: #4f97d7;">)</span>
</pre>
</div>

<p>
This one is pretty simple. It binds C-s to swiper and M-x to counsel-M-x.
Those two keys are probably amongs the two most used keybindings in Emacs. But
General allows more complex solution to keybindings definition. Let’s say we
want all of our personnal keybindings bound to C-c XY, where XY is a
combination of our choice. We can define a :prefix.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #4f97d7;">(</span>general-define-key
 <span style="color: #4f97d7;">:prefix</span> <span style="color: #2d9574;">"C-c"</span>
 <span style="color: #2aa1ae; background-color: #292e34;">;; </span><span style="color: #2aa1ae; background-color: #292e34;">bind to simple key press</span>
 <span style="color: #2d9574;">"b"</span> 'ivy-switch-buffer  <span style="color: #2aa1ae; background-color: #292e34;">; </span><span style="color: #2aa1ae; background-color: #292e34;">change buffer, chose using ivy</span>
 <span style="color: #2d9574;">"/"</span>   'counsel-git-grep   <span style="color: #2aa1ae; background-color: #292e34;">; </span><span style="color: #2aa1ae; background-color: #292e34;">find string in git project</span>
 <span style="color: #2aa1ae; background-color: #292e34;">;; </span><span style="color: #2aa1ae; background-color: #292e34;">bind to double key press</span>
 <span style="color: #2d9574;">"ff"</span>  'counsel-find-file  <span style="color: #2aa1ae; background-color: #292e34;">; </span><span style="color: #2aa1ae; background-color: #292e34;">find file using ivy</span>
 <span style="color: #2d9574;">"fr"</span>  'counsel-recentf    <span style="color: #2aa1ae; background-color: #292e34;">; </span><span style="color: #2aa1ae; background-color: #292e34;">find recently edited files</span>
 <span style="color: #2d9574;">"pf"</span>  'counsel-git        <span style="color: #2aa1ae; background-color: #292e34;">; </span><span style="color: #2aa1ae; background-color: #292e34;">find file in git project</span>
 <span style="color: #4f97d7;">)</span>
</pre>
</div>

<p>
Now C-c b switches buffer using Ivy. And C-c f then f finds files. And C-c f
then r find recent files. Now we can see a pattern here: we just placed all
command related to finding files under a C-c f prefix. It would be great if we
could know when we press C-c what the f corresponds to.
</p>

<p>
But hey it is Emacs. There is a package for it. It is called which-key. So
guess what ?
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">use-package</span> <span style="color: #a45bad;">which-key</span> <span style="color: #4f97d7;">:ensure</span> t<span style="color: #4f97d7;">)</span>
</pre>
</div>

<p>
So now when we press C-c, a nice buffer shows up that pressing b will execute
ivy-switch-buffer. But what does it show for f ? “+prefix”. We can do better.
We can indicate to Which-key that C-c f related functions corresponds to file
related operations.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">use-package</span> <span style="color: #a45bad;">which-key</span> <span style="color: #4f97d7;">:ensure</span> t
             <span style="color: #4f97d7;">:config</span>
             <span style="color: #bc6ec5;">(</span>which-key-add-key-based-replacement
              <span style="color: #2d9574;">"C-c f"</span> <span style="color: #2d9574;">"file"</span>
              <span style="color: #2d9574;">"C-c ff"</span> <span style="color: #2d9574;">"find file"</span>
              <span style="color: #2d9574;">"C-c fr"</span> <span style="color: #2d9574;">"recently edited"</span>
              <span style="color: #2d9574;">"C-c p"</span>  <span style="color: #2d9574;">"project"</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
</pre>
</div>

<p>
Execute this code with C-x C-e as usual. Now press C-c, and see how much
which-key is awesome. Never forget a keybinding. Very easy on beginners. Very
swift. Very clean. Does it ?
</p>

<p>
There is some kind of code duplication here. We define it using General, and
describe it using Which-key. In fact we can do both in the same statement,
using Which-key integration to General.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #4f97d7;">(</span>general-define-key
 <span style="color: #4f97d7;">:prefix</span> <span style="color: #2d9574;">"C-c"</span>
 <span style="color: #2aa1ae; background-color: #292e34;">;; </span><span style="color: #2aa1ae; background-color: #292e34;">bind to simple key press</span>
 <span style="color: #2d9574;">"b"</span> 'ivy-switch-buffer  <span style="color: #2aa1ae; background-color: #292e34;">; </span><span style="color: #2aa1ae; background-color: #292e34;">change buffer, chose using ivy</span>
 <span style="color: #2d9574;">"/"</span>   'counsel-git-grep   <span style="color: #2aa1ae; background-color: #292e34;">; </span><span style="color: #2aa1ae; background-color: #292e34;">find string in git project</span>
 <span style="color: #2aa1ae; background-color: #292e34;">;; </span><span style="color: #2aa1ae; background-color: #292e34;">bind to double key press</span>
 <span style="color: #2d9574;">"f"</span>   '<span style="color: #bc6ec5;">(</span><span style="color: #4f97d7;">:ignore</span> t <span style="color: #4f97d7;">:which-key</span> <span style="color: #2d9574;">"files"</span><span style="color: #bc6ec5;">)</span>
 <span style="color: #2d9574;">"ff"</span>  'counsel-find-file
 <span style="color: #2d9574;">"fr"</span>  'counsel-recentf
 <span style="color: #2d9574;">"p"</span>   '<span style="color: #bc6ec5;">(</span><span style="color: #4f97d7;">:ignore</span> t <span style="color: #4f97d7;">:which-key</span> <span style="color: #2d9574;">"project"</span><span style="color: #bc6ec5;">)</span>
 <span style="color: #2d9574;">"pf"</span>  '<span style="color: #bc6ec5;">(</span>counsel-git <span style="color: #4f97d7;">:which-key</span> <span style="color: #2d9574;">"find file in git dir"</span><span style="color: #bc6ec5;">)</span>
 <span style="color: #4f97d7;">)</span>
</pre>
</div>

<p>
Evaluate this code. Press C-c. Same output as before. See how General is great
?
</p>
</div>
</div>

<div id="outline-container-orgheadline5" class="outline-2">
<h2 id="orgheadline5"><span class="section-number-2">5</span> Meeting our goal: build yourself a great Spacemacs-like experience</h2>
<div class="outline-text-2" id="text-5">
<p>
<a href="https://images.unsplash.com/photo-1443928281170-6900dc50ac55">https://images.unsplash.com/photo-1443928281170-6900dc50ac55</a>
</p>

<p>
For Evil users out there, General also has nice integration with Evil states.
It means that we can easily define keybindings to match Spacemacs design
styles. And yet we retain the ability to build the editor we want. That is
what we came to Emacs in the beginning.
</p>

<p>
Check out what this chunk does.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">use-package</span> <span style="color: #a45bad;">general</span> <span style="color: #4f97d7;">:ensure</span> t
             <span style="color: #4f97d7;">:config</span>
             <span style="color: #bc6ec5;">(</span>general-define-key
              <span style="color: #4f97d7;">:states</span> '<span style="color: #2d9574;">(</span>normal visual insert emacs<span style="color: #2d9574;">)</span>
              <span style="color: #4f97d7;">:prefix</span> <span style="color: #2d9574;">"SPC"</span>
              <span style="color: #4f97d7;">:non-normal-prefix</span> <span style="color: #2d9574;">"C-SPC"</span>

              <span style="color: #2aa1ae; background-color: #292e34;">;; </span><span style="color: #2aa1ae; background-color: #292e34;">simple command</span>
              <span style="color: #2d9574;">"'"</span>   '<span style="color: #2d9574;">(</span>iterm-focus <span style="color: #4f97d7;">:which-key</span> <span style="color: #2d9574;">"iterm"</span><span style="color: #2d9574;">)</span>
              <span style="color: #2d9574;">"?"</span>   '<span style="color: #2d9574;">(</span>iterm-goto-filedir-or-home <span style="color: #4f97d7;">:which-key</span> <span style="color: #2d9574;">"iterm - goto dir"</span><span style="color: #2d9574;">)</span>
              <span style="color: #2d9574;">"/"</span>   'counsel-ag
              <span style="color: #2d9574;">"TAB"</span> '<span style="color: #2d9574;">(</span>switch-to-other-buffer <span style="color: #4f97d7;">:which-key</span> <span style="color: #2d9574;">"prev buffer"</span><span style="color: #2d9574;">)</span>
              <span style="color: #2d9574;">"SPC"</span> '<span style="color: #2d9574;">(</span>avy-goto-word-or-subword-1  <span style="color: #4f97d7;">:which-key</span> <span style="color: #2d9574;">"go to char"</span><span style="color: #2d9574;">)</span>

              <span style="color: #2aa1ae; background-color: #292e34;">;; </span><span style="color: #2aa1ae; background-color: #292e34;">Applications</span>
              <span style="color: #2d9574;">"a"</span> '<span style="color: #2d9574;">(</span><span style="color: #4f97d7;">:ignore</span> t <span style="color: #4f97d7;">:which-key</span> <span style="color: #2d9574;">"Applications"</span><span style="color: #2d9574;">)</span>
              <span style="color: #2d9574;">"ar"</span> 'ranger
              <span style="color: #2d9574;">"ad"</span> 'dired<span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
</pre>
</div>

<p>
When Evil is in normal or visual state, the prefix is SPC, as in Spacemacs.
When Evil is in insert or emacs state, the prefix is C-SPC. We can define some
key under direct access, describe them using Which-key. We can then define
prefix easily, using the :ignore t keyword. See how close we are from
Spacemacs ?
</p>

<p>
So then why not just use Spacemacs and be done with it ? Well, I like the SPC
prefix thing too much to let the Spacemacs dev decide for me what keybindings
must refer too. I want to make my own Emacs. I want to be able to define
:prefix easily. I want to understand what Emacs does, without having to read
the entire Spacemacs code base. I want an editor that I can customize to its
inner deepness, without being hit by design choices I did not make.
</p>

<p>
And then Spacemacs has one major drawback to me: it is very Qwerty-keyboard
oriented. It means that when you use another keyboard layout, you make some
weird movement just to accomodate Spacemacs keybindings.
</p>
</div>
</div>

<div id="outline-container-orgheadline6" class="outline-2">
<h2 id="orgheadline6"><span class="section-number-2">6</span> A recipe for a modern Emacs experience</h2>
<div class="outline-text-2" id="text-6">
<p>
I have put up a recipe to build a Spacemacs-like Emacs. It is based on what I
have done systematically, to build a reasonable and very usable emacs to me.
</p>

<ol class="org-ol">
<li>Spot a package that seems interesting.</li>
<li>Install it using use-package and its :ensure t keyword.</li>
<li>Use it for an hour or two.</li>
<li>Determine the functions you need.</li>
<li>Create autoloading for it using use-package abilities to deferred loading.</li>
<li>Create a keybinding for it using general, under the :prefix you like. Use
SPC to look like Spacemacs.</li>
<li>Describe it using which-key or using the :which-key keyword of general
definition.</li>
<li>There is no other step. Use your package.</li>
</ol>

<p>
I mean, really. You only need those seven steps. You need use-package,
general, which-key. And finally you also need abo-abo packages. They are just
too awesome.
</p>
</div>
</div>

</div>
</div>
<div>
        <div class="post-meta">
            <span title="post date" class="post-info">2016-10-17</span>
            <span title="last modification date" class="post-info">2016-10-13</span>
            <span title="tags" class="post-info">:N/A:</span>
            <span title="author" class="post-info"><a href="mailto:lujun9972 &lt;at&gt; lujun9972-F41">lujun9972</a></span>
        </div>
    <script src="http://lujun9972.github.io/emacs-document/media/js/jquery-2.1.3.min.js"></script>
        <section>
            <h1>Comments</h1>
            <div id="comment-wrap">
                    <a class="disqus_label">使用 Disqus 评论</a>
                    <a class="ds-label">使用多说评论</a>
    </ul>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
         //var disqus_developer = 1;
         var preempt_signal=false;
         var disqus_identifier = "/blog/2016/10/17/how-to-build-your-own-spacemacs/";
         var disqus_url = "http://lujun9972.github.io/emacs-document/blog/2016/10/17/how-to-build-your-own-spacemacs/";
         var disqus_shortname = 'emacs-document';
         /* * * DON'T EDIT BELOW THIS LINE * * */
         (function() {
             var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
             dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
             (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
             $('#disqus_thread').css('display','none');
         })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        <div class="ds-thread"></div>
        <script type="text/javascript">
         var duoshuoQuery = {short_name:'emacs-document'};
         (function() {
             var ds = document.createElement('script');
             ds.type = 'text/javascript';ds.async = true;
             ds.src = 'http://static.duoshuo.com/embed.js';
             ds.charset = 'UTF-8';
             (document.getElementsByTagName('head')[0]
           || document.getElementsByTagName('body')[0]).appendChild(ds);
             $('.ds-thread').css('display','block');
         })();
        </script>
    <script>
     /* comments */
     var ego_disqus_thread=$('#disqus_thread');
     var ego_ds_label=$('.ds-thread');
     $('.disqus_label').click(function(){
         ego_disqus_thread.show();
         ego_ds_label.hide();
     });
     $('.ds-label').click(function(){
         ego_disqus_thread.hide();
         ego_ds_label.show();
     });
    </script>
        </section>
    <script src="http://lujun9972.github.io/emacs-document/media/js/main.js"></script>
    <div class="footer">
        <p>Generated by <a href="http://www.gnu.org/software/emacs/">Emacs</a> 25.x(<a href="http://orgmode.org">Org mode</a> 8.x)</p>
        <p>
            Copyright &copy; 2014 - <span id="footerYear"></span> <a href="mailto:lujun9972 &lt;at&gt; lujun9972-F41">lujun9972</a>
            &nbsp;&nbsp;-&nbsp;&nbsp;
            Powered by <a href="https://github.com/emacs-china/ego" target="_blank">EGO</a><br/>
            <a href="http://creativecommons.org/licenses/by-sa/3.0/" rel="license"><img src="http://i.creativecommons.org/l/by-sa/3.0/88x31.png" style="border-width:0" alt="Creative Commons License" class="center"></a>
            <script type="text/javascript">document.getElementById("footerYear").innerHTML = (new Date()).getFullYear();</script>
        </p>
    </div>
            </div>
            <script type="text/javascript"
                    src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_SVG">
            </script>
            <script type="text/x-mathjax-config">
             MathJax.Hub.Config({ TeX: { equationNumbers: {autoNumber: "AMS"} } });
            </script>
</div>

  </div></body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <title>Blogging-using-org-mode-and-nothing-else - EMACS-DOCUMENT</title>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"/>
  <meta name="author" content="lujun9972" />
  <style>
   #ds-thread #ds-reset .ds-comment-body p {color: #ffffff;}
   #ds-thread #ds-reset .ds-comment-body p a {color: #ff0;}
   #ds-thread #ds-reset .ds-comment-body p a:hover {color: #0ff;}
   #disqus_thread a {color: #00ffff;}
  </style>
  <link rel="stylesheet" href="http://lujun9972.github.io/emacs-document/media/css/main.css" type="text/css"/>
  <link rel="stylesheet" href="http://lujun9972.github.io/emacs-document/media/css/comment.css" type="text/css"/>
</head>

  <body><div class="container">
<div>
  <header class="masthead">
    <h1 class="masthead-title"><a href="http://lujun9972.github.io/emacs-document/">EMACS-DOCUMENT</a></h1>
    <p>=============&gt;集思广益</p>
    <nav class="site-nav">
      <div class="menu-icon">
        <svg viewBox="0 0 18 15">
          <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z" fill="#ffff00"/>
          <path d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z" fill="#ffff00"/>
          <path d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z" fill="#ffff00"/>
        </svg>
      </div>
      <ul class="trigger">
        <li><a href="http://lujun9972.github.io/emacs-document/years/">Years</a></li>
        <li><a href="http://lujun9972.github.io/emacs-document/authors/">Authors</a></li>
        <li><a href="http://lujun9972.github.io/emacs-document/tags/">Tags</a></li>
        <li><a href="http://lujun9972.github.io/emacs-document/about/">About</a></li>
        <li><a href="https://github.com/lujun9972/emacs-document">Github</a></li>
        <li><a href="http://lujun9972.github.io/emacs-document/rss.xml">RSS</a></li>
      </ul>
    </nav>
    <form method="get" id="searchform" action="http://www.google.com/search">
      <input type="text" class="field" name="q" id="s" placeholder="Search">
      <input type="hidden" name="as_sitesearch" value="lujun9972.github.io/emacs-document">
    </form>
  </header>
</div>

<div>
<div class="post">
<h1 class="title">Blogging-using-org-mode-and-nothing-else</h1>
<p>
As you can tell, the look of this website has changed significantly—and it was about time for that. In case
you didn't know, this site used to be hosted on <a href="http://web.ics.purdue.edu/"><a href="http://web.ics.purdue.edu/">http://web.ics.purdue.edu/</a></a>, which provides <a href="https://www.itap.purdue.edu/learning/careeraccount/webpage.html">free webspace for</a>
<a href="https://www.itap.purdue.edu/learning/careeraccount/webpage.html">Purdue students</a>. I used to generate the static HTML pages from plaintext markdown files using the Python-based
static site generator <a href="http://blog.getpelican.com/">Pelican</a>. It worked well for a while, but I ended up having a few issues with that setup:
</p>

<ul class="org-ul">
<li>The <a href="https://web.ics.purdue.edu/">host</a> was painstakingly slow to reach from anywhere but the Purdue networks</li>
<li>Pelican would just break sometimes, providing me with nothing but some cryptic Python exception messages</li>
<li>The website did not use TLS and loaded a lot of external content over an unencrypted HTTP connection,
causing it to render incompletely when using <a href="https://www.eff.org/HTTPS-everywhere">HTTPS Everywhere</a></li>
<li>I prefer <a href="http://orgmode.org/">Org-mode</a> over the <a href="http://www.wilfred.me.uk/blog/2012/07/30/why-markdown-is-not-my-favourite-language/">fragmented Markdown</a> syntax for writing plaintext documents</li>
<li><a href="http://orgmode.org/worg/org-contrib/babel/examples/fontify-src-code-blocks.html">Source code blocks are prettier in Org-mode</a></li>
</ul>

<p>
So, of course, I looked for an alternative.
</p>

<p>
Since I was predisposed towards using Org-mode for this, <a href="http://orgmode.org/manual/Publishing.html">Org's publishing feature</a> was the first alternative I
investigated. I don't have high demands—all I need is a lightweight, stable, static site generator. I don't
need tag clouds, sophisticated pagination, theme support (I'm fine with hacking together my own CSS), or any
kind of plugin support; all I really need is a small org-to-HTML converter that can be hacked using Elisp and
that I can bolt the extras that I want onto. After browsing around a little bit, I found some neat examples 
<a href="http://bastibe.de/2013-11-13-blogging-with-emacs.html">here</a>, <a href="https://justin.abrah.ms/emacs/orgmode_static_site_generator.html">here</a> and <a href="https://pavpanchekha.com/blog/org-mode-publish.html">here</a>. These sites are exactly what I wanted—minimalist, simple, and based on pure Org.
</p>

<p>
Obviously, the Org publishing feature was all that I needed. I whipped up a nice little configuration that
produces this website from a set of Org source files, some custom CSS and HTML, and some custom Elisp. This is
what happens at a high level:
</p>

<ul class="org-ul">
<li>All of the blog's files sit in the ~/repos/blog directory and are version controlled using git</li>
<li>The custom Elisp sits in <a href="https://ogbe.net/emacsconfig.html">my emacs config</a>. You can find a copy of the relevant sections below.</li>
<li>The source files can be roughly divided into the following categories:
<ul class="org-ul">
<li>/blog/—Each blog post is contained in an individual Org-file</li>
<li>/pages/—Static Pages, like the <a href="https://ogbe.net/index.html">landing page</a>, sit in their own directory as Org files</li>
<li>/res/—Contains custom CSS and the <a href="https://www.mathjax.org/">MathJax</a> JavaScript</li>
</ul></li>
<li>Org's publishing function org-publish uses magic (and some Lisp) to spit out simple, easy to read, and
easy to render HTML from these sources (and a few others)</li>
<li>After the HTML files are generated, I'm using <a href="https://rsync.samba.org/">rsync</a> to push them onto a Tec-X1 instance from <a href="https://bladetec.de/">bladetec</a>,
which runs <a href="https://www.nginx.com/">nginx</a> on Ubuntu 14.04 and costs a phenomenal €0.99 a month</li>
</ul>

<p>
Here's the obligatory screenshot of me editing this post in Emacs:
</p>


<div class="figure">
<p><img src="https://ogbe.net/img/blogging_with_org_large.png" alt="blogging_with_org_large.png" />
</p>
</div>

<p>
There are a few tricks involved in doing this—mostly concerning the generation of the sitemap—, but I will let
the relevant section of <a href="https://ogbe.net/emacsconfig.html">my config</a> speak for themselves, since they're pretty well commented (I think):
</p>

<p>
UPDATE <span class="timestamp-wrapper"><span class="timestamp">&lt;2016-02-02 二&gt;</span></span>:
</p>

<p>
I've received a few questions asking whether there exists an RSS feed for this blog. There wasn't until today,
but <a href="https://ogbe.net/blog.xml">I think this will work</a>. I'm using <a href="http://orgmode.org/w/?p=org-mode.git;a=blob_plain;f=contrib/lisp/ox-rss.el;hb=HEAD">ox-rss.el</a> to generate XML from the blog's sitemap. I had to trick it
into doing a few things like generating the correct pubdates and permalinks, but I think it works fine for
what I need. The code below is the updated version, with RSS.
</p>

<p>
The publishing uses the Org HTML export backend a lot, so to start off, we require it here, along with the RSS
publishing backend.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">require</span> '<span style="color: #a45bad;">ox-html</span><span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">require</span> '<span style="color: #a45bad;">ox-rss</span><span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">setq</span> org-export-html-coding-system 'utf-8-unix<span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">setq</span> org-html-viewport nil<span style="color: #4f97d7;">)</span>
</pre>
</div>

<p>
Next, we define some functions and variables that will be used by org-publish. First, let's define the website
headers, footers, and make sure that the exported HTML points to the right style sheets.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">setq</span> my-blog-extra-head
      <span style="color: #bc6ec5;">(</span>concat
       <span style="color: #2d9574;">"&lt;link rel='stylesheet' href='/../res/code.css' /&gt;\n"</span>
       <span style="color: #2d9574;">"&lt;link rel='stylesheet' href='/../res/main.css' /&gt;"</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>

<span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">setq</span> my-blog-header-file <span style="color: #2d9574;">"~/repos/blog/header.html"</span><span style="color: #4f97d7;">)</span>
<span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">defun</span> <span style="color: #bc6ec5; font-weight: bold;">my-blog-header</span> <span style="color: #bc6ec5;">(</span>arg<span style="color: #bc6ec5;">)</span>
  <span style="color: #bc6ec5;">(</span><span style="color: #4f97d7; font-weight: bold;">with-temp-buffer</span>
    <span style="color: #2d9574;">(</span>insert-file-contents my-blog-header-file<span style="color: #2d9574;">)</span>
    <span style="color: #2d9574;">(</span>buffer-string<span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>

<span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">setq</span> my-blog-footer
      <span style="color: #2d9574;">"&lt;hr /&gt;\n</span>
<span style="color: #2d9574;">&lt;p&gt;&lt;span style=\"float: left;\"&gt;&lt;a href= \"/blog.xml\"&gt;RSS&lt;/a&gt;&lt;/span&gt;</span>
<span style="color: #2d9574;">License: &lt;a href= \"https://creativecommons.org/licenses/by-sa/4.0/\"&gt;CC BY-SA 4.0&lt;/a&gt;&lt;/p&gt;\n</span>
<span style="color: #2d9574;">&lt;p&gt;&lt;a href= \"/contact.html\"&gt; Contact&lt;/a&gt;&lt;/p&gt;\n"</span><span style="color: #4f97d7;">)</span>
</pre>
</div>

<p>
I'd also like to export drawers out to HTML; this idea is ripped directly from <a href="https://pavpanchekha.com/blog/org-mode-publish.html">here</a>.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">defun</span> <span style="color: #bc6ec5; font-weight: bold;">my-blog-org-export-format-drawer</span> <span style="color: #bc6ec5;">(</span>name content<span style="color: #bc6ec5;">)</span>
  <span style="color: #bc6ec5;">(</span>concat <span style="color: #2d9574;">"&lt;div class=\"drawer "</span> <span style="color: #2d9574;">(</span>downcase name<span style="color: #2d9574;">)</span> <span style="color: #2d9574;">"\"&gt;\n"</span>
          <span style="color: #2d9574;">"&lt;h6&gt;"</span> <span style="color: #2d9574;">(</span>capitalize name<span style="color: #2d9574;">)</span> <span style="color: #2d9574;">"&lt;/h6&gt;\n"</span>
          content
          <span style="color: #2d9574;">"\n&lt;/div&gt;"</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
</pre>
</div>

<p>
<a href="https://www.mathjax.org/">MathJax</a> usually recommends to use their CDN to load their JavaScript code, but I want to use a version that
sits on my server.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">setq</span> my-blog-local-mathjax
      '<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">(</span>path <span style="color: #2d9574;">"/res/mj/MathJax.js?config=TeX-AMS-MML_HTMLorMML"</span><span style="color: #2d9574;">)</span>
        <span style="color: #2d9574;">(</span>scale <span style="color: #2d9574;">"100"</span><span style="color: #2d9574;">)</span> <span style="color: #2d9574;">(</span>align <span style="color: #2d9574;">"center"</span><span style="color: #2d9574;">)</span> <span style="color: #2d9574;">(</span>indent <span style="color: #2d9574;">"2em"</span><span style="color: #2d9574;">)</span> <span style="color: #2d9574;">(</span>tagside <span style="color: #2d9574;">"right"</span><span style="color: #2d9574;">)</span>
        <span style="color: #2d9574;">(</span>mathml nil<span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
</pre>
</div>

<p>
Now we'll get to some of the customizations I've bolted on Org's publishing features. In it's standard
configuration, the <a href="http://orgmode.org/manual/Sitemap.html">sitemap</a> generator produces a plain, kind of boring looking list of posts, which was
inadequate for me. After hacking on the sitemap generation function for a little while, I came up with the
following solution: When I write a blog post, I enclose the "preview" part of the post in #+BEGIN_PREVIEW&#x2026;#
+END_PREVIEW tags, which my (very simple) parser then inserts into the sitemap page.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">defun</span> <span style="color: #bc6ec5; font-weight: bold;">my-blog-get-preview</span> <span style="color: #bc6ec5;">(</span>file<span style="color: #bc6ec5;">)</span>
  <span style="color: #2aa1ae;">"The comments in FILE have to be on their own lines, prefereably before and after paragraphs."</span>
  <span style="color: #bc6ec5;">(</span><span style="color: #4f97d7; font-weight: bold;">with-temp-buffer</span>
    <span style="color: #2d9574;">(</span>insert-file-contents file<span style="color: #2d9574;">)</span>
    <span style="color: #2d9574;">(</span>goto-char <span style="color: #67b11d;">(</span>point-min<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
    <span style="color: #2d9574;">(</span><span style="color: #4f97d7; font-weight: bold;">let</span> <span style="color: #67b11d;">(</span><span style="color: #b1951d;">(</span>beg <span style="color: #4f97d7;">(</span>+ <span style="color: #a45bad;">1</span> <span style="color: #bc6ec5;">(</span>re-search-forward <span style="color: #2d9574;">"^#\\+BEGIN_PREVIEW$"</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span><span style="color: #b1951d;">)</span>
          <span style="color: #b1951d;">(</span>end <span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">progn</span> <span style="color: #bc6ec5;">(</span>re-search-forward <span style="color: #2d9574;">"^#\\+END_PREVIEW$"</span><span style="color: #bc6ec5;">)</span>
                      <span style="color: #bc6ec5;">(</span>match-beginning <span style="color: #a45bad;">0</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span><span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span>
      <span style="color: #67b11d;">(</span>buffer-substring beg end<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>

<span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">defun</span> <span style="color: #bc6ec5; font-weight: bold;">my-blog-sitemap</span> <span style="color: #bc6ec5;">(</span>project <span style="color: #ce537a; font-weight: bold;">&amp;optional</span> sitemap-filename<span style="color: #bc6ec5;">)</span>
  <span style="color: #2aa1ae;">"Generate the sitemap for my blog."</span>
  <span style="color: #bc6ec5;">(</span><span style="color: #4f97d7; font-weight: bold;">let*</span> <span style="color: #2d9574;">(</span><span style="color: #67b11d;">(</span>project-plist <span style="color: #b1951d;">(</span>cdr project<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span>
         <span style="color: #67b11d;">(</span>dir <span style="color: #b1951d;">(</span>file-name-as-directory
               <span style="color: #4f97d7;">(</span>plist-get project-plist <span style="color: #4f97d7;">:base-directory</span><span style="color: #4f97d7;">)</span><span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span>
         <span style="color: #67b11d;">(</span>localdir <span style="color: #b1951d;">(</span>file-name-directory dir<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span>
         <span style="color: #67b11d;">(</span>exclude-regexp <span style="color: #b1951d;">(</span>plist-get project-plist <span style="color: #4f97d7;">:exclude</span><span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span>
         <span style="color: #67b11d;">(</span>files <span style="color: #b1951d;">(</span>nreverse
                 <span style="color: #4f97d7;">(</span>org-publish-get-base-files project exclude-regexp<span style="color: #4f97d7;">)</span><span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span>
         <span style="color: #67b11d;">(</span>sitemap-filename <span style="color: #b1951d;">(</span>concat dir <span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">or</span> sitemap-filename <span style="color: #2d9574;">"sitemap.org"</span><span style="color: #4f97d7;">)</span><span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span>
         <span style="color: #67b11d;">(</span>sitemap-sans-extension
          <span style="color: #b1951d;">(</span>plist-get project-plist <span style="color: #4f97d7;">:sitemap-sans-extension</span><span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span>
         <span style="color: #67b11d;">(</span>visiting <span style="color: #b1951d;">(</span>find-buffer-visiting sitemap-filename<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span>
         file sitemap-buffer<span style="color: #2d9574;">)</span>
    <span style="color: #2d9574;">(</span><span style="color: #4f97d7; font-weight: bold;">with-current-buffer</span>
        <span style="color: #67b11d;">(</span><span style="color: #4f97d7; font-weight: bold;">let</span> <span style="color: #b1951d;">(</span><span style="color: #4f97d7;">(</span>org-inhibit-startup t<span style="color: #4f97d7;">)</span><span style="color: #b1951d;">)</span>
          <span style="color: #b1951d;">(</span><span style="color: #4f97d7; font-weight: bold;">setq</span> sitemap-buffer
                <span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">or</span> visiting <span style="color: #bc6ec5;">(</span>find-file sitemap-filename<span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span><span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span>
      <span style="color: #67b11d;">(</span>erase-buffer<span style="color: #67b11d;">)</span>
      <span style="color: #2aa1ae; background-color: #292e34;">;; </span><span style="color: #2aa1ae; background-color: #292e34;">loop through all of the files in the project</span>
      <span style="color: #67b11d;">(</span><span style="color: #4f97d7; font-weight: bold;">while</span> <span style="color: #b1951d;">(</span><span style="color: #4f97d7; font-weight: bold;">setq</span> file <span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">pop</span> files<span style="color: #4f97d7;">)</span><span style="color: #b1951d;">)</span>
        <span style="color: #b1951d;">(</span><span style="color: #4f97d7; font-weight: bold;">let</span> <span style="color: #4f97d7;">(</span><span style="color: #bc6ec5;">(</span>fn <span style="color: #2d9574;">(</span>file-name-nondirectory file<span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span>
              <span style="color: #bc6ec5;">(</span>link <span style="color: #2aa1ae; background-color: #292e34;">;; </span><span style="color: #2aa1ae; background-color: #292e34;">changed this to fix links. see postprocessor.</span>
               <span style="color: #2d9574;">(</span>file-relative-name file <span style="color: #9cb6ad;">(</span>file-name-as-directory
                                         <span style="color: #4f97d7;">(</span>expand-file-name <span style="color: #bc6ec5;">(</span>concat <span style="color: #2d9574;">(</span>file-name-as-directory dir<span style="color: #2d9574;">)</span> <span style="color: #2d9574;">".."</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span><span style="color: #9cb6ad;">)</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span>
              <span style="color: #bc6ec5;">(</span>oldlocal localdir<span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
          <span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">when</span> sitemap-sans-extension
            <span style="color: #bc6ec5;">(</span><span style="color: #4f97d7; font-weight: bold;">setq</span> link <span style="color: #2d9574;">(</span>file-name-sans-extension link<span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
          <span style="color: #2aa1ae; background-color: #292e34;">;; </span><span style="color: #2aa1ae; background-color: #292e34;">sitemap shouldn't list itself</span>
          <span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">unless</span> <span style="color: #bc6ec5;">(</span>equal <span style="color: #2d9574;">(</span>file-truename sitemap-filename<span style="color: #2d9574;">)</span>
                         <span style="color: #2d9574;">(</span>file-truename file<span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span>
            <span style="color: #bc6ec5;">(</span><span style="color: #4f97d7; font-weight: bold;">let</span> <span style="color: #2d9574;">(</span><span style="color: #2aa1ae; background-color: #292e34;">;; </span><span style="color: #2aa1ae; background-color: #292e34;">get the title and date of the current file</span>
                  <span style="color: #9cb6ad;">(</span>title <span style="color: #4f97d7;">(</span>org-publish-format-file-entry <span style="color: #2d9574;">"%t"</span> file project-plist<span style="color: #4f97d7;">)</span><span style="color: #9cb6ad;">)</span>
                  <span style="color: #9cb6ad;">(</span>date <span style="color: #4f97d7;">(</span>org-publish-format-file-entry <span style="color: #2d9574;">"%d"</span> file project-plist<span style="color: #4f97d7;">)</span><span style="color: #9cb6ad;">)</span>
                  <span style="color: #2aa1ae; background-color: #292e34;">;; </span><span style="color: #2aa1ae; background-color: #292e34;">get the preview section from the current file</span>
                  <span style="color: #9cb6ad;">(</span>preview <span style="color: #4f97d7;">(</span>my-blog-get-preview file<span style="color: #4f97d7;">)</span><span style="color: #9cb6ad;">)</span>
                  <span style="color: #9cb6ad;">(</span>regexp <span style="color: #2d9574;">"</span><span style="color: #2d9574; font-weight: bold;">\\</span><span style="color: #2d9574; font-weight: bold;">(</span><span style="color: #2d9574;">.*</span><span style="color: #2d9574; font-weight: bold;">\\</span><span style="color: #2d9574; font-weight: bold;">)</span><span style="color: #2d9574;">\\[</span><span style="color: #2d9574; font-weight: bold;">\\</span><span style="color: #2d9574; font-weight: bold;">(</span><span style="color: #2d9574;">[</span><span style="color: #a45bad;">^</span><span style="color: #2d9574;">][]+</span><span style="color: #2d9574; font-weight: bold;">\\</span><span style="color: #2d9574; font-weight: bold;">)</span><span style="color: #2d9574;">\\]</span><span style="color: #2d9574; font-weight: bold;">\\</span><span style="color: #2d9574; font-weight: bold;">(</span><span style="color: #2d9574;">.*</span><span style="color: #2d9574; font-weight: bold;">\\</span><span style="color: #2d9574; font-weight: bold;">)</span><span style="color: #2d9574;">"</span><span style="color: #9cb6ad;">)</span><span style="color: #2d9574;">)</span>
              <span style="color: #2aa1ae; background-color: #292e34;">;; </span><span style="color: #2aa1ae; background-color: #292e34;">insert a horizontal line before every post, kill the first one</span>
              <span style="color: #2aa1ae; background-color: #292e34;">;; </span><span style="color: #2aa1ae; background-color: #292e34;">before saving</span>
              <span style="color: #2d9574;">(</span>insert <span style="color: #2d9574;">"-----\n"</span><span style="color: #2d9574;">)</span>
              <span style="color: #2d9574;">(</span><span style="color: #4f97d7; font-weight: bold;">cond</span> <span style="color: #9cb6ad;">(</span><span style="color: #4f97d7;">(</span>string-match-p regexp title<span style="color: #4f97d7;">)</span>
                     <span style="color: #4f97d7;">(</span>string-match regexp title<span style="color: #4f97d7;">)</span>
                     <span style="color: #2aa1ae; background-color: #292e34;">;; </span><span style="color: #2aa1ae; background-color: #292e34;">insert every post as headline</span>
                     <span style="color: #4f97d7;">(</span>insert <span style="color: #bc6ec5;">(</span>concat<span style="color: #2d9574;">"* "</span> <span style="color: #2d9574;">(</span>match-string <span style="color: #a45bad;">1</span> title<span style="color: #2d9574;">)</span>
                                    <span style="color: #2d9574;">"[[file:"</span> link <span style="color: #2d9574;">"]["</span>
                                    <span style="color: #2d9574;">(</span>match-string <span style="color: #a45bad;">2</span> title<span style="color: #2d9574;">)</span>
                                    <span style="color: #2d9574;">"]]"</span> <span style="color: #2d9574;">(</span>match-string <span style="color: #a45bad;">3</span> title<span style="color: #2d9574;">)</span> <span style="color: #2d9574;">"\n"</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span><span style="color: #9cb6ad;">)</span>
                    <span style="color: #9cb6ad;">(</span>t <span style="color: #4f97d7;">(</span>insert <span style="color: #bc6ec5;">(</span>concat <span style="color: #2d9574;">"* [[file:"</span> link <span style="color: #2d9574;">"]["</span> title <span style="color: #2d9574;">"]]\n"</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span><span style="color: #9cb6ad;">)</span><span style="color: #2d9574;">)</span>
              <span style="color: #2aa1ae; background-color: #292e34;">;; </span><span style="color: #2aa1ae; background-color: #292e34;">add properties for `</span><span style="color: #a45bad; background-color: #292e34;">ox-rss.el</span><span style="color: #2aa1ae; background-color: #292e34;">' here</span>
              <span style="color: #2d9574;">(</span><span style="color: #4f97d7; font-weight: bold;">let</span> <span style="color: #9cb6ad;">(</span><span style="color: #4f97d7;">(</span>rss-permalink <span style="color: #bc6ec5;">(</span>concat <span style="color: #2d9574;">(</span>file-name-sans-extension link<span style="color: #2d9574;">)</span> <span style="color: #2d9574;">".html"</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
                    <span style="color: #4f97d7;">(</span>rss-pubdate <span style="color: #bc6ec5;">(</span>format-time-string
                                  <span style="color: #2d9574;">(</span>car org-time-stamp-formats<span style="color: #2d9574;">)</span>
                                  <span style="color: #2d9574;">(</span>org-publish-find-date file<span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span><span style="color: #9cb6ad;">)</span>
                <span style="color: #9cb6ad;">(</span>org-set-property <span style="color: #2d9574;">"RSS_PERMALINK"</span> rss-permalink<span style="color: #9cb6ad;">)</span>
                <span style="color: #9cb6ad;">(</span>org-set-property <span style="color: #2d9574;">"PUBDATE"</span> rss-pubdate<span style="color: #9cb6ad;">)</span><span style="color: #2d9574;">)</span>
              <span style="color: #2aa1ae; background-color: #292e34;">;; </span><span style="color: #2aa1ae; background-color: #292e34;">insert the date, preview, &amp; read more link</span>
              <span style="color: #2d9574;">(</span>insert <span style="color: #9cb6ad;">(</span>concat date <span style="color: #2d9574;">"\n\n"</span><span style="color: #9cb6ad;">)</span><span style="color: #2d9574;">)</span>
              <span style="color: #2d9574;">(</span>insert preview<span style="color: #2d9574;">)</span>
              <span style="color: #2d9574;">(</span>insert <span style="color: #9cb6ad;">(</span>concat <span style="color: #2d9574;">"[[file:"</span> link <span style="color: #2d9574;">"][Read More...]]\n"</span><span style="color: #9cb6ad;">)</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span><span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span>
      <span style="color: #2aa1ae; background-color: #292e34;">;; </span><span style="color: #2aa1ae; background-color: #292e34;">kill the first hrule to make this look OK</span>
      <span style="color: #67b11d;">(</span>goto-char <span style="color: #b1951d;">(</span>point-min<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span>
      <span style="color: #67b11d;">(</span><span style="color: #4f97d7; font-weight: bold;">let</span> <span style="color: #b1951d;">(</span><span style="color: #4f97d7;">(</span>kill-whole-line t<span style="color: #4f97d7;">)</span><span style="color: #b1951d;">)</span> <span style="color: #b1951d;">(</span>kill-line<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span>
      <span style="color: #67b11d;">(</span>save-buffer<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
    <span style="color: #2d9574;">(</span><span style="color: #4f97d7; font-weight: bold;">or</span> visiting <span style="color: #67b11d;">(</span>kill-buffer sitemap-buffer<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
</pre>
</div>

<p>
Next I define some pre-and postprocessors that run during the publishing process. They are used to move around
some files before and after publishing.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp">  <span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">setq</span> my-blog-emacs-config-name <span style="color: #2d9574;">"emacsconfig.org"</span><span style="color: #4f97d7;">)</span>
  <span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">setq</span> my-blog-process-emacs-config nil<span style="color: #4f97d7;">)</span>

  <span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">defun</span> <span style="color: #bc6ec5; font-weight: bold;">my-blog-pages-preprocessor</span> <span style="color: #bc6ec5;">()</span>
    <span style="color: #2aa1ae;">"Move a fresh version of the settings.org file to the pages directory."</span>
    <span style="color: #bc6ec5;">(</span><span style="color: #4f97d7; font-weight: bold;">when</span> my-blog-process-emacs-config
      <span style="color: #2d9574;">(</span><span style="color: #4f97d7; font-weight: bold;">let*</span> <span style="color: #67b11d;">(</span><span style="color: #b1951d;">(</span>cfg-file <span style="color: #4f97d7;">(</span>expand-file-name <span style="color: #bc6ec5;">(</span>concat <span style="color: #2d9574;">(</span>file-name-as-directory user-emacs-directory<span style="color: #2d9574;">)</span>
                                                 <span style="color: #2d9574;">"settings.org"</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span><span style="color: #b1951d;">)</span>
             <span style="color: #b1951d;">(</span>destdir <span style="color: #4f97d7;">(</span>file-name-as-directory <span style="color: #bc6ec5;">(</span>plist-get project-plist <span style="color: #4f97d7;">:base-directory</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span><span style="color: #b1951d;">)</span>
             <span style="color: #b1951d;">(</span>cfg-file-dest <span style="color: #4f97d7;">(</span>expand-file-name <span style="color: #bc6ec5;">(</span>concat destdir my-blog-emacs-config-name<span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span><span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span>
        <span style="color: #67b11d;">(</span>copy-file cfg-file cfg-file-dest t<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>

  <span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">defun</span> <span style="color: #bc6ec5; font-weight: bold;">my-blog-pages-postprocessor</span> <span style="color: #bc6ec5;">()</span>
    <span style="color: #bc6ec5;">(</span>message <span style="color: #2d9574;">"In the pages postprocessor."</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>

  <span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">defun</span> <span style="color: #bc6ec5; font-weight: bold;">my-blog-articles-preprocessor</span> <span style="color: #bc6ec5;">()</span>
    <span style="color: #bc6ec5;">(</span>message <span style="color: #2d9574;">"In the articles preprocessor."</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>

  <span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">defun</span> <span style="color: #bc6ec5; font-weight: bold;">my-blog-articles-postprocessor</span> <span style="color: #bc6ec5;">()</span>
    <span style="color: #2aa1ae;">"Massage the sitemap file and move it up one directory.</span>

<span style="color: #2aa1ae;">for this to work, we have already fixed the creation of the</span>
<span style="color: #2aa1ae;">relative link in the sitemap-publish function"</span>
  <span style="color: #bc6ec5;">(</span><span style="color: #4f97d7; font-weight: bold;">let*</span> <span style="color: #2d9574;">(</span><span style="color: #67b11d;">(</span>sitemap-fn <span style="color: #b1951d;">(</span>concat <span style="color: #4f97d7;">(</span>file-name-sans-extension <span style="color: #bc6ec5;">(</span>plist-get project-plist <span style="color: #4f97d7;">:sitemap-filename</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span> <span style="color: #2d9574;">".html"</span><span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span>
         <span style="color: #67b11d;">(</span>sitemap-olddir <span style="color: #b1951d;">(</span>plist-get project-plist <span style="color: #4f97d7;">:publishing-directory</span><span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span>
         <span style="color: #67b11d;">(</span>sitemap-newdir <span style="color: #b1951d;">(</span>expand-file-name <span style="color: #4f97d7;">(</span>concat <span style="color: #bc6ec5;">(</span>file-name-as-directory sitemap-olddir<span style="color: #bc6ec5;">)</span> <span style="color: #2d9574;">".."</span><span style="color: #4f97d7;">)</span><span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span>
         <span style="color: #67b11d;">(</span>sitemap-oldfile <span style="color: #b1951d;">(</span>expand-file-name sitemap-fn sitemap-olddir<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span>
         <span style="color: #67b11d;">(</span>sitemap-newfile <span style="color: #b1951d;">(</span>expand-file-name <span style="color: #4f97d7;">(</span>concat <span style="color: #bc6ec5;">(</span>file-name-as-directory sitemap-newdir<span style="color: #bc6ec5;">)</span> sitemap-fn<span style="color: #4f97d7;">)</span><span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
    <span style="color: #2d9574;">(</span><span style="color: #4f97d7; font-weight: bold;">with-temp-buffer</span>
      <span style="color: #67b11d;">(</span>goto-char <span style="color: #b1951d;">(</span>point-min<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span>
      <span style="color: #67b11d;">(</span>insert-file-contents sitemap-oldfile<span style="color: #67b11d;">)</span>
      <span style="color: #2aa1ae; background-color: #292e34;">;; </span><span style="color: #2aa1ae; background-color: #292e34;">massage the sitemap if wanted</span>

      <span style="color: #2aa1ae; background-color: #292e34;">;; </span><span style="color: #2aa1ae; background-color: #292e34;">delete the old file and write the correct one</span>
      <span style="color: #67b11d;">(</span>delete-file sitemap-oldfile<span style="color: #67b11d;">)</span>
      <span style="color: #67b11d;">(</span>write-file sitemap-newfile<span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
</pre>
</div>

<p>
The next preprocessor runs <a href="http://csstidy.sourceforge.net/">CSSTidy</a> on the site's CSS.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">defun</span> <span style="color: #bc6ec5; font-weight: bold;">my-blog-minify-css</span> <span style="color: #bc6ec5;">()</span>
  <span style="color: #bc6ec5;">(</span><span style="color: #4f97d7; font-weight: bold;">let*</span> <span style="color: #2d9574;">(</span><span style="color: #67b11d;">(</span>csstidy <span style="color: #2d9574;">"csstidy"</span><span style="color: #67b11d;">)</span>
         <span style="color: #67b11d;">(</span>csstidy-args <span style="color: #2d9574;">" --template=highest --silent=true"</span><span style="color: #67b11d;">)</span>
         <span style="color: #67b11d;">(</span>css-dir <span style="color: #b1951d;">(</span>expand-file-name <span style="color: #4f97d7;">(</span>plist-get project-plist <span style="color: #4f97d7;">:publishing-directory</span><span style="color: #4f97d7;">)</span><span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span>
         <span style="color: #67b11d;">(</span>css-files <span style="color: #b1951d;">(</span>directory-files css-dir t <span style="color: #2d9574;">"^.*\\.css$"</span><span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
    <span style="color: #2d9574;">(</span><span style="color: #4f97d7; font-weight: bold;">dolist</span> <span style="color: #67b11d;">(</span>file css-files<span style="color: #67b11d;">)</span>
      <span style="color: #67b11d;">(</span><span style="color: #4f97d7; font-weight: bold;">with-temp-buffer</span>
        <span style="color: #b1951d;">(</span>insert <span style="color: #4f97d7;">(</span>shell-command-to-string <span style="color: #bc6ec5;">(</span>concat csstidy <span style="color: #2d9574;">" "</span> file csstidy-args<span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span><span style="color: #b1951d;">)</span>
        <span style="color: #b1951d;">(</span>write-file file<span style="color: #b1951d;">)</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
</pre>
</div>

<p>
Most of the publishing settings are defined in org-publish-project-alist.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #4f97d7;">(</span><span style="color: #4f97d7; font-weight: bold;">setq</span> org-publish-project-alist
      `<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">(</span><span style="color: #2d9574;">"blog"</span>
         <span style="color: #4f97d7;">:components</span> <span style="color: #67b11d;">(</span><span style="color: #2d9574;">"blog-articles"</span>, <span style="color: #2d9574;">"blog-pages"</span>, <span style="color: #2d9574;">"blog-rss"</span>, <span style="color: #2d9574;">"blog-res"</span>, <span style="color: #2d9574;">"blog-images"</span>, <span style="color: #2d9574;">"blog-dl"</span><span style="color: #67b11d;">)</span><span style="color: #2d9574;">)</span>
        <span style="color: #2d9574;">(</span><span style="color: #2d9574;">"blog-articles"</span>
         <span style="color: #4f97d7;">:base-directory</span> <span style="color: #2d9574;">"~/repos/blog/blog/"</span>
         <span style="color: #4f97d7;">:base-extension</span> <span style="color: #2d9574;">"org"</span>
         <span style="color: #4f97d7;">:publishing-directory</span> <span style="color: #2d9574;">"~/repos/blog/www/blog/"</span>
         <span style="color: #4f97d7;">:publishing-function</span> org-html-publish-to-html
         <span style="color: #4f97d7;">:preparation-function</span> my-blog-articles-preprocessor
         <span style="color: #4f97d7;">:completion-function</span> my-blog-articles-postprocessor
         <span style="color: #4f97d7;">:htmlized-source</span> t <span style="color: #2aa1ae; background-color: #292e34;">;; </span><span style="color: #2aa1ae; background-color: #292e34;">this enables htmlize, which means that I can use css for code!</span>

         <span style="color: #4f97d7;">:with-author</span> t
         <span style="color: #4f97d7;">:with-creator</span> nil
         <span style="color: #4f97d7;">:with-date</span> t

         <span style="color: #4f97d7;">:headline-level</span> <span style="color: #a45bad;">4</span>
         <span style="color: #4f97d7;">:section-numbers</span> nil
         <span style="color: #4f97d7;">:with-toc</span> nil
         <span style="color: #4f97d7;">:with-drawers</span> t
         <span style="color: #4f97d7;">:with-sub-superscript</span> nil <span style="color: #2aa1ae; background-color: #292e34;">;; </span><span style="color: #2aa1ae; background-color: #292e34;">important!!</span>

         <span style="color: #2aa1ae; background-color: #292e34;">;; </span><span style="color: #2aa1ae; background-color: #292e34;">the following removes extra headers from HTML output -- important!</span>
         <span style="color: #4f97d7;">:html-link-home</span> <span style="color: #2d9574;">"/"</span>
         <span style="color: #4f97d7;">:html-head</span> nil <span style="color: #2aa1ae; background-color: #292e34;">;; </span><span style="color: #2aa1ae; background-color: #292e34;">cleans up anything that would have been in there.</span>
         <span style="color: #4f97d7;">:html-head-extra</span> ,my-blog-extra-head
         <span style="color: #4f97d7;">:html-head-include-default-style</span> nil
         <span style="color: #4f97d7;">:html-head-include-scripts</span> nil
         <span style="color: #4f97d7;">:html-viewport</span> nil

         <span style="color: #4f97d7;">:html-format-drawer-function</span> my-blog-org-export-format-drawer
         <span style="color: #4f97d7;">:html-home/up-format</span> <span style="color: #2d9574;">""</span>
         <span style="color: #4f97d7;">:html-mathjax-options</span> ,my-blog-local-mathjax
         <span style="color: #4f97d7;">:html-mathjax-template</span> <span style="color: #2d9574;">"&lt;script type=\"text/javascript\" src=\"%PATH\"&gt;&lt;/script&gt;"</span>
         <span style="color: #4f97d7;">:html-footnotes-section</span> <span style="color: #2d9574;">"&lt;div id='footnotes'&gt;&lt;!--%s--&gt;%s&lt;/div&gt;"</span>
         <span style="color: #4f97d7;">:html-link-up</span> <span style="color: #2d9574;">""</span>
         <span style="color: #4f97d7;">:html-link-home</span> <span style="color: #2d9574;">""</span>
         <span style="color: #4f97d7;">:html-preamble</span> my-blog-header
         <span style="color: #4f97d7;">:html-postamble</span> ,my-blog-footer

         <span style="color: #2aa1ae; background-color: #292e34;">;; </span><span style="color: #2aa1ae; background-color: #292e34;">sitemap - list of blog articles</span>
         <span style="color: #4f97d7;">:auto-sitemap</span> t
         <span style="color: #4f97d7;">:sitemap-filename</span> <span style="color: #2d9574;">"blog.org"</span>
         <span style="color: #4f97d7;">:sitemap-title</span> <span style="color: #2d9574;">"Blog"</span>
         <span style="color: #2aa1ae; background-color: #292e34;">;; </span><span style="color: #2aa1ae; background-color: #292e34;">custom sitemap generator function</span>
         <span style="color: #4f97d7;">:sitemap-function</span> my-blog-sitemap
         <span style="color: #4f97d7;">:sitemap-sort-files</span> anti-chronologically
         <span style="color: #4f97d7;">:sitemap-date-format</span> <span style="color: #2d9574;">"Published: %a %b %d %Y"</span><span style="color: #2d9574;">)</span>
        <span style="color: #2d9574;">(</span><span style="color: #2d9574;">"blog-pages"</span>
         <span style="color: #4f97d7;">:base-directory</span> <span style="color: #2d9574;">"~/repos/blog/pages/"</span>
         <span style="color: #4f97d7;">:base-extension</span> <span style="color: #2d9574;">"org"</span>
         <span style="color: #4f97d7;">:publishing-directory</span> <span style="color: #2d9574;">"~/repos/blog/www/"</span>
         <span style="color: #4f97d7;">:publishing-function</span> org-html-publish-to-html
         <span style="color: #4f97d7;">:preparation-function</span> my-blog-pages-preprocessor
         <span style="color: #4f97d7;">:completion-function</span> my-blog-pages-postprocessor
         <span style="color: #4f97d7;">:htmlized-source</span> t

         <span style="color: #4f97d7;">:with-author</span> t
         <span style="color: #4f97d7;">:with-creator</span> nil
         <span style="color: #4f97d7;">:with-date</span> t

         <span style="color: #4f97d7;">:headline-level</span> <span style="color: #a45bad;">4</span>
         <span style="color: #4f97d7;">:section-numbers</span> nil
         <span style="color: #4f97d7;">:with-toc</span> nil
         <span style="color: #4f97d7;">:with-drawers</span> t
         <span style="color: #4f97d7;">:with-sub-superscript</span> nil <span style="color: #2aa1ae; background-color: #292e34;">;; </span><span style="color: #2aa1ae; background-color: #292e34;">important!!</span>
         <span style="color: #4f97d7;">:html-viewport</span> nil <span style="color: #2aa1ae; background-color: #292e34;">;; </span><span style="color: #2aa1ae; background-color: #292e34;">hasn't worked yet</span>

         <span style="color: #2aa1ae; background-color: #292e34;">;; </span><span style="color: #2aa1ae; background-color: #292e34;">the following removes extra headers from HTML output -- important!</span>
         <span style="color: #4f97d7;">:html-link-home</span> <span style="color: #2d9574;">"/"</span>
         <span style="color: #4f97d7;">:html-head</span> nil <span style="color: #2aa1ae; background-color: #292e34;">;; </span><span style="color: #2aa1ae; background-color: #292e34;">cleans up anything that would have been in there.</span>
         <span style="color: #4f97d7;">:html-head-extra</span> ,my-blog-extra-head
         <span style="color: #4f97d7;">:html-head-include-default-style</span> nil
         <span style="color: #4f97d7;">:html-head-include-scripts</span> nil

         <span style="color: #4f97d7;">:html-format-drawer-function</span> my-blog-org-export-format-drawer
         <span style="color: #4f97d7;">:html-home/up-format</span> <span style="color: #2d9574;">""</span>
         <span style="color: #4f97d7;">:html-mathjax-options</span> ,my-blog-local-mathjax
         <span style="color: #4f97d7;">:html-mathjax-template</span> <span style="color: #2d9574;">"&lt;script type=\"text/javascript\" src=\"%PATH\"&gt;&lt;/script&gt;"</span>
         <span style="color: #4f97d7;">:html-footnotes-section</span> <span style="color: #2d9574;">"&lt;div id='footnotes'&gt;&lt;!--%s--&gt;%s&lt;/div&gt;"</span>
         <span style="color: #4f97d7;">:html-link-up</span> <span style="color: #2d9574;">""</span>
         <span style="color: #4f97d7;">:html-link-home</span> <span style="color: #2d9574;">""</span>

         <span style="color: #4f97d7;">:html-preamble</span> my-blog-header
         <span style="color: #4f97d7;">:html-postamble</span> ,my-blog-footer<span style="color: #2d9574;">)</span>
        <span style="color: #2d9574;">(</span><span style="color: #2d9574;">"blog-rss"</span>
         <span style="color: #4f97d7;">:base-directory</span> <span style="color: #2d9574;">"~/repos/blog/blog/"</span>
         <span style="color: #4f97d7;">:base-extension</span> <span style="color: #2d9574;">"org"</span>
         <span style="color: #4f97d7;">:publishing-directory</span> <span style="color: #2d9574;">"~/repos/blog/www/"</span>
         <span style="color: #4f97d7;">:publishing-function</span> org-rss-publish-to-rss

         <span style="color: #4f97d7;">:html-link-home</span> <span style="color: #2d9574;">"https://ogbe.net/"</span>
         <span style="color: #4f97d7;">:html-link-use-abs-url</span> t

         <span style="color: #4f97d7;">:title</span> <span style="color: #2d9574;">"Dennis Ogbe"</span>
         <span style="color: #4f97d7;">:rss-image-url</span> <span style="color: #2d9574;">"https://ogbe.loc/img/feed-icon-28x28.png"</span>
         <span style="color: #4f97d7;">:section-numbers</span> nil
         <span style="color: #4f97d7;">:exclude</span> <span style="color: #2d9574;">".*"</span>
         <span style="color: #4f97d7;">:include</span> <span style="color: #67b11d;">(</span><span style="color: #2d9574;">"blog.org"</span><span style="color: #67b11d;">)</span>
         <span style="color: #4f97d7;">:table-of-contents</span> nil<span style="color: #2d9574;">)</span>
        <span style="color: #2d9574;">(</span><span style="color: #2d9574;">"blog-res"</span>
         <span style="color: #4f97d7;">:base-directory</span> <span style="color: #2d9574;">"~/repos/blog/res/"</span>
         <span style="color: #4f97d7;">:base-extension</span> <span style="color: #2d9574;">".*"</span>
         <span style="color: #4f97d7;">:publishing-directory</span> <span style="color: #2d9574;">"~/repos/blog/www/res/"</span>
         <span style="color: #4f97d7;">:publishing-function</span> org-publish-attachment
         <span style="color: #4f97d7;">:completion-function</span> my-blog-minify-css<span style="color: #2d9574;">)</span>
        <span style="color: #2d9574;">(</span><span style="color: #2d9574;">"blog-images"</span>
         <span style="color: #4f97d7;">:base-directory</span> <span style="color: #2d9574;">"~/repos/blog/img/"</span>
         <span style="color: #4f97d7;">:base-extension</span> <span style="color: #2d9574;">".*"</span>
         <span style="color: #4f97d7;">:publishing-directory</span> <span style="color: #2d9574;">"~/repos/blog/www/img/"</span>
         <span style="color: #4f97d7;">:publishing-function</span> org-publish-attachment
         <span style="color: #4f97d7;">:recursive</span> t<span style="color: #2d9574;">)</span>
        <span style="color: #2d9574;">(</span><span style="color: #2d9574;">"blog-dl"</span>
         <span style="color: #4f97d7;">:base-directory</span> <span style="color: #2d9574;">"~/repos/blog/dl/"</span>
         <span style="color: #4f97d7;">:base-extension</span> <span style="color: #2d9574;">".*"</span>
         <span style="color: #4f97d7;">:publishing-directory</span> <span style="color: #2d9574;">"~/repos/blog/www/dl/"</span>
         <span style="color: #4f97d7;">:publishing-function</span> org-publish-attachment
         <span style="color: #4f97d7;">:Recursive</span> t<span style="color: #2d9574;">)</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
</pre>
</div>

<p>
Finally, define a small template for new blog posts.
</p>

<div class="org-src-container">

<pre class="src src-emacs-lisp"><span style="color: #4f97d7;">(</span>add-to-list 'org-structure-template-alist
             '<span style="color: #bc6ec5;">(</span><span style="color: #2d9574;">"b"</span> <span style="color: #2d9574;">"#+TITLE: ?</span>
<span style="color: #2d9574;">#+AUTHOR: Dennis Ogbe</span>
<span style="color: #2d9574;">#+EMAIL: do@ogbe.net</span>
<span style="color: #2d9574;">#+DATE:</span>
<span style="color: #2d9574;">#+STARTUP: showall</span>
<span style="color: #2d9574;">#+STARTUP: inlineimages</span>
<span style="color: #2d9574;">#+BEGIN_PREVIEW\n\n#+END_PREVIEW\n"</span><span style="color: #bc6ec5;">)</span><span style="color: #4f97d7;">)</span>
</pre>
</div>

<p>
If you'd like, you can <a href="https://ogbe.net/contact.html">let me know what you think</a>. I appreciate any sorts of feedback.
</p>

<p>
Dennis
</p>

</div>
</div>
<div>
        <div class="post-meta">
            <span title="post date" class="post-info">2016-10-10</span>
            <span title="last modification date" class="post-info">2016-10-10</span>
            <span title="tags" class="post-info">:N/A:</span>
            <span title="author" class="post-info"><a href="mailto:lujun9972 &lt;at&gt; lujun9972-F41">lujun9972</a></span>
        </div>
    <script src="http://lujun9972.github.io/emacs-document/media/js/jquery-2.1.3.min.js"></script>
        <section>
            <h1>Comments</h1>
            <div id="comment-wrap">
                    <a class="disqus_label">使用 Disqus 评论</a>
                    <a class="ds-label">使用多说评论</a>
    </ul>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
         //var disqus_developer = 1;
         var preempt_signal=false;
         var disqus_identifier = "/blog/2016/10/10/blogging-using-org-mode-and-nothing-else/";
         var disqus_url = "http://lujun9972.github.io/emacs-document/blog/2016/10/10/blogging-using-org-mode-and-nothing-else/";
         var disqus_shortname = 'emacs-document';
         /* * * DON'T EDIT BELOW THIS LINE * * */
         (function() {
             var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
             dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
             (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
             $('#disqus_thread').css('display','none');
         })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        <div class="ds-thread"></div>
        <script type="text/javascript">
         var duoshuoQuery = {short_name:'emacs-document'};
         (function() {
             var ds = document.createElement('script');
             ds.type = 'text/javascript';ds.async = true;
             ds.src = 'http://static.duoshuo.com/embed.js';
             ds.charset = 'UTF-8';
             (document.getElementsByTagName('head')[0]
           || document.getElementsByTagName('body')[0]).appendChild(ds);
             $('.ds-thread').css('display','block');
         })();
        </script>
    <script>
     /* comments */
     var ego_disqus_thread=$('#disqus_thread');
     var ego_ds_label=$('.ds-thread');
     $('.disqus_label').click(function(){
         ego_disqus_thread.show();
         ego_ds_label.hide();
     });
     $('.ds-label').click(function(){
         ego_disqus_thread.hide();
         ego_ds_label.show();
     });
    </script>
        </section>
    <script src="http://lujun9972.github.io/emacs-document/media/js/main.js"></script>
    <div class="footer">
        <p>Generated by <a href="http://www.gnu.org/software/emacs/">Emacs</a> 25.x(<a href="http://orgmode.org">Org mode</a> 8.x)</p>
        <p>
            Copyright &copy; 2014 - <span id="footerYear"></span> <a href="mailto:lujun9972 &lt;at&gt; lujun9972-F41">lujun9972</a>
            &nbsp;&nbsp;-&nbsp;&nbsp;
            Powered by <a href="https://github.com/emacs-china/ego" target="_blank">EGO</a><br/>
            <a href="http://creativecommons.org/licenses/by-sa/3.0/" rel="license"><img src="http://i.creativecommons.org/l/by-sa/3.0/88x31.png" style="border-width:0" alt="Creative Commons License" class="center"></a>
            <script type="text/javascript">document.getElementById("footerYear").innerHTML = (new Date()).getFullYear();</script>
        </p>
    </div>
            </div>
            <script type="text/javascript"
                    src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_SVG">
            </script>
            <script type="text/x-mathjax-config">
             MathJax.Hub.Config({ TeX: { equationNumbers: {autoNumber: "AMS"} } });
            </script>
</div>

  </div></body>
</html>
